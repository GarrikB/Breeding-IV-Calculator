<!DOCTYPE html>
<html lang="en">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>IV Calculator</title>
    <link rel="stylesheet" href="./IVCalc.css">
</head>
<body>

<div id="root">
    <div id="stats-div">
        <table class='stats-table'>
            <tbody>
                <tr>
                    <th></th>
                    <th>HP</th>
                    <th>ATK</th>
                    <th>DEF</th>
                    <th>SP.ATK</th>
                    <th>SP.DEF</th>
                    <th>SPEED</th>
                    <th>ITEM</th>
                </tr>
                <tr>
                    <td>Parent 1</td>
                    <td>
                        <input id="p1-checkbox-hp" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p1-checkbox-atk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p1-checkbox-def" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p1-checkbox-spatk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p1-checkbox-spdef" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p1-checkbox-speed" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <select id="p1-item">
                            <option value="DK">Destiny Knot</option>
                            <option value="HP">Power Weight (HP)</option>
                            <option value="ATK">Power Bracer (ATK)</option>
                            <option value="DEF">Power Belt (DEF)</option>
                            <option value="SPATK">Power Lens (SP.ATK)</option>
                            <option value="SPDEF">Power Band (SP.DEF)</option>
                            <option value="SPEED">Power Anklet (SPEED)</option>
                            <option value="">-----Nothing-----</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Parent 2</td>
                    <td>
                        <input id="p2-checkbox-hp" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p2-checkbox-atk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p2-checkbox-def" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p2-checkbox-spatk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p2-checkbox-spdef" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="p2-checkbox-speed" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <select id="p2-item">
                            <option value="DK">Destiny Knot</option>
                            <option value="HP">Power Weight (HP)</option>
                            <option value="ATK">Power Bracer (ATK)</option>
                            <option value="DEF">Power Belt (DEF)</option>
                            <option value="SPATK">Power Lens (SP.ATK)</option>
                            <option value="SPDEF">Power Band (SP.DEF)</option>
                            <option value="SPEED">Power Anklet (SPEED)</option>
                            <option value="">-----Nothing-----</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Child</td>
                    <td>
                        <input id="child-checkbox-hp" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="child-checkbox-atk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="child-checkbox-def" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="child-checkbox-spatk" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="child-checkbox-spdef" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td>
                        <input id="child-checkbox-speed" class="stat-checkbox" onmouseover="check(this)" type="checkbox">
                    </td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <table>
            <tr>
                <th></th>
                <th>Gender</th>
                <th>Ability</th>
                <th>Nature</th>
                <th>Shiny</th>
            </tr>
            <tr>
                <td>Modifiers:</td>
                <td>
                    <select id="gender-chance">
                        <option value="">Ignore</option>
                        <option value="1">12.5%</option>
                        <option value="2">25%</option>
                        <option value="4">50%</option>
                        <option value="6">75%</option>
                        <option value="7">87.5%</option>
                    </select>
                </td>
                <td>
                    <select id="ability-chance">
                        <option value="">Ignore</option>
                        <option value="1">20%</option>
                        <option value="2">40%</option>
                        <option value="3">60%</option>
                        <option value="4">80%</option>
                    </select>
                </td>
                <td>
                    <select id="nature-chance">
                        <option value="">Ignore</option>
                        <option value="1">4% (1/25)</option>
                        <option value="12.5">50% (1/2)</option>
                    </select>
                </td>
                <td>
                    <select id="shiny-chance">
                        <option value="">Ignore</option>
                        <option value="1">1/4096</option>
                        <option value="3">3/4096 (~1/1365)</option>
                        <option value="6">6/4096 (~1/683)</option>
                        <option value="8">8/4096 (1/512)</option>
                    </select>
                </td>
            </tr>
        </table>
        <button id="button" onclick="eggChanceDiv()">Calculate</button>
        <div id="result"></div>
    </div>
    <div id="details-div">
        <div>
            <h3>Modifiers explained:</h3>
            <b>Gender:</b><br>
            ?% = Gender chance is completely dependant on the species' gender ratio <br>
            <br>
            <b>Abilities:</b><br>
            1/1(100%) = Species only has 1 ability<br>
            4/5(80%) = Chance of female passing down its ability<br>
            3/5(60%) = Chance of female passing down its hidden ability(HA)<br>
            3/5(60%) = Chance of male/genderless passing down HA when bred with Ditto<br>
            0/1(0%) = Chance of male/genderless passing down HA when bred with anything other than Ditto<br>
            <br>
            <b>Natures:</b><br>
            1/1(100%) = Chance of getting a specificnature if one of the parents is holding the Everstone <br>
            1/2(50%) = Chance of getting a specific nature if parents have different natures and both are holding the Everstone <br>
            1/25(4%) = Chance of getting a specific nature if none of the parents are holding an Everstone <br>
            <br>
            <b>Shiny:</b><br>
            1/4096 = Default chance of getting a Shiny (No Shiny Charm and No Masuda Method)<br>
            3/4096 = Chance of getting a shiny if you have the Shiny Charm (No Masuda Method)<br>
            6/4096 = Chance of getting a shiny if you are using the Masuda Method (No Shiny Charm)<br>
            8/4096 = Chance of getting a shine if you have the Shiny Charm and are using the Masuda Method<br>
        </div>
    </div>
</div>

<script>

const parseAndFix = (num, fixedNum = 4) => parseFloat( num.toFixed(fixedNum) )

const chance = (pencentage, numberofTries) => ( 1 - Math.pow( ( 1 - ( pencentage / 100 ) ), numberofTries ) ) * 100

function trChance(result, arrayNum = [1]){
    let tableRows = ''
    for (let i=0;i<arrayNum.length;i++){
        tableRows += `
            <tr>
                <td>${arrayNum[i]}</td>
                <td>${ chance(result, arrayNum[i]) < 0.000001 && chance(result, arrayNum[i]) !== 0 ? '<0.000001' : parseAndFix( chance( result, arrayNum[i] ), 6 ) }%</td>
            </tr>
        `
    }
    return tableRows
}

function eggChanceDiv() {
    const result = parseAndFix( calculate(), 20 ) 
    document.getElementById("result").innerHTML = `
        Chance of egg: <b>${ result > 0 ?  parseAndFix(result, 6) : 0 }%</b> or roughly: ${ result === 0 ? "<b>Never</b>." : `<b>1 in ${ parseAndFix( 100/result, 4 ) }</b> eggs.`}
        <br>
        <table>
            <tr>
                <th>Eggs</th>
                <th>Chance</th>
            </tr>
            ${trChance(result, [1,5,20,50,100,200,500,1000])}
        </table>`; 
}

function calculate() {
    const parent1 = {
        stats:{
            'HP': document.getElementById("p1-checkbox-hp").checked,
            'ATK': document.getElementById("p1-checkbox-atk").checked,
            'DEF': document.getElementById("p1-checkbox-def").checked,
            'SPATK': document.getElementById("p1-checkbox-spatk").checked,
            'SPDEF': document.getElementById("p1-checkbox-spdef").checked,
            'SPEED': document.getElementById("p1-checkbox-speed").checked,
        },
        item: document.getElementById("p1-item").value,
    }
    const parent2 = {
        stats:{
            'HP': document.getElementById("p2-checkbox-hp").checked,
            'ATK': document.getElementById("p2-checkbox-atk").checked,
            'DEF': document.getElementById("p2-checkbox-def").checked,
            'SPATK': document.getElementById("p2-checkbox-spatk").checked,
            'SPDEF': document.getElementById("p2-checkbox-spdef").checked,
            'SPEED': document.getElementById("p2-checkbox-speed").checked,
        },
        item: document.getElementById("p2-item").value,
    }
    const desiredOutcome = {
        'HP'   : document.getElementById("child-checkbox-hp").checked,
        'ATK'  : document.getElementById("child-checkbox-atk").checked,
        'DEF'  : document.getElementById("child-checkbox-def").checked,
        'SPATK': document.getElementById("child-checkbox-spatk").checked,
        'SPDEF': document.getElementById("child-checkbox-spdef").checked,
        'SPEED': document.getElementById("child-checkbox-speed").checked,
    }

    const spreadPossibilities = {
        'DK':[ // Possible spreads with Destiny knot
            ['HP','ATK','DEF','SPATK','SPDEF'],
            ['HP','ATK','DEF','SPATK',        'SPEED'],
            ['HP','ATK','DEF',        'SPDEF','SPEED'],
            ['HP','ATK',      'SPATK','SPDEF','SPEED'],
            ['HP',      'DEF','SPATK','SPDEF','SPEED'],
            [     'ATK','DEF','SPATK','SPDEF','SPEED'],
        ],
        'noDK':[ // Possible spreads WITHOUT Destiny knot
            ['HP','ATK','DEF'],
            ['HP','ATK','SPATK'],
            ['HP','ATK','SPDEF'],
            ['HP','ATK','SPEED'],
            ['HP','DEF','SPATK'],
            ['HP','DEF','SPDEF'],
            ['HP','DEF','SPEED'],
            ['HP','SPATK','SPDEF'],
            ['HP','SPATK','SPEED'],
            ['HP','SPDEF','SPEED'],
            ['ATK','DEF','SPATK'],
            ['ATK','DEF','SPDEF'],
            ['ATK','DEF','SPEED'],
            ['ATK','SPATK','SPDEF'],
            ['ATK','SPATK','SPEED'],
            ['ATK','SPDEF','SPEED'],
            ['DEF','SPATK','SPDEF'],
            ['DEF','SPATK','SPEED'],
            ['DEF','SPDEF','SPEED'],
            ['SPATK','SPDEF','SPEED']
        ]
    }

    const usingDK = (parent1.item === 'DK' || parent2.item === 'DK'); // Is one of the parents holding a Destiny Knot
    const usingPI = ('DK' !== parent1.item && '' !== parent1.item || 'DK' !== parent2.item && '' !== parent2.item) // Is one of the parents holding a Power Item
    const bothUsingPI = ('DK' !== parent1.item && '' !== parent1.item && 'DK' !== parent2.item && '' !== parent2.item) // Are BOTH of the parents holding a Power Item

    const parentsTotalIVs = Object.values(parent1.stats).map( (val,index) => val || Object.values(parent2.stats)[index] ).filter( (val) => val ).length;
    const numberofDesiredIVs = Object.values(desiredOutcome).filter( (val) => val ).length; // Object.values returns an array with the object's values, filter creates a new array with values that are true(wanted)

    let chanceofDesiredOutcome = 0; // Total percentage chance of desired outcome

    let spreadNumerator = 1;
    let spreadDenominator = 1;

    let spreadsUsed = [];

    if ( usingDK && parentsTotalIVs + 1 < numberofDesiredIVs || !usingDK && parentsTotalIVs + 3 < numberofDesiredIVs ) // if both parents combined don't have enough IVs, it is impossible to get the desired outcome
        return chanceofDesiredOutcome = 0

    if ( usingDK ) {

        spreadsUsed = usingPI ? Object.values(spreadPossibilities.DK.filter( (val) => val.includes(parent1.item) || val.includes(parent2.item) )) : Object.values(spreadPossibilities.DK);
    
    } else {

        if ( 'DK' !== parent1.item && '' !== parent1.item ) // If both parents hold a different PI only one will be passed down
            spreadsUsed = spreadsUsed.concat( Object.values( spreadPossibilities.noDK.filter( (val) => val.includes(parent1.item) ) ) ) // Filter possible spreads with parent1's PI

        if ( 'DK' !== parent2.item && '' !== parent2.item )
            spreadsUsed = spreadsUsed.concat( Object.values( spreadPossibilities.noDK.filter( (val) => val.includes(parent2.item) ) ) ) // Filter possible spreads with parent2's PI

        if ( !usingPI ) 
            spreadsUsed = Object.values(spreadPossibilities.noDK)
            
    }
    
    for ( let i=0; i<spreadsUsed.length; i++ ) {
        spreadNumerator = 1;
        spreadDenominator = spreadsUsed.length; // Amount of spreads that have a chance of generating desired outcome
        
        for (let j=0; j<spreadsUsed[i].length;j++) {
            
            if ( desiredOutcome[spreadsUsed[i][j]] ) { // Is this stat desired

                let parentItem = i < 10 ? parent1.item : parent2.item
                let parent = i < 10 ? parent1 : parent2
                
                if( parent1.item !== parent2.item  && bothUsingPI && spreadsUsed[i][j] === parentItem ) { // if BOTH parents have different PIs
                    
                    if( parentItem === spreadsUsed[i][j] && parent.stats[parentItem] ) {
                        
                        spreadNumerator   *= 1;
                        spreadDenominator *= 1;

                    } else if ( parentItem === spreadsUsed[i][j] && !parent.stats[parentItem] ) {
                        
                        spreadNumerator   *= 0;
                        spreadDenominator *= 1;

                    } 
                
                } else if ( ( spreadsUsed[i][j] === parent1.item || spreadsUsed[i][j] === parent2.item ) && !bothUsingPI ) {

                    if( parent1.item === parent2.item && parent1.stats[parent1.item] !== parent2.stats[parent2.item] ) { // if BOTH parents are holding the same PI but have different stats
                        
                        spreadNumerator   *= 1;
                        spreadDenominator *= 2;

                    } else if ( desiredOutcome[spreadsUsed[i][j]] === parent1.stats[parent1.item] || desiredOutcome[spreadsUsed[i][j]] === parent2.stats[parent2.item] ) {
                        
                        spreadNumerator   *= 1;
                        spreadDenominator *= 1;

                    } else {

                        return chanceofDesiredOutcome = 0; // Stat is desired but parent without desired IV holding a power item prevents a desired IV from being passed down
                    
                    }

                } else if ( parent1.stats[spreadsUsed[i][j]] && parent2.stats[spreadsUsed[i][j]] ) {

                    spreadNumerator   *= 1;
                    spreadDenominator *= 1;

                } else if ( parent1.stats[spreadsUsed[i][j]] || parent2.stats[spreadsUsed[i][j]] ) {

                    spreadNumerator   *= 1;
                    spreadDenominator *= 2;

                } else {
                    spreadNumerator   *= 0;
                    spreadDenominator *= 1;
                }

            }

        }

        const remainingIVs = ['HP','ATK','DEF','SPATK','SPDEF','SPEED'].filter( x => !spreadsUsed[i].includes(x) ) // Filters which stats are in the current spread and keeps the ones that aren't

        for (let k=0; k<remainingIVs.length; k++) {
            if ( desiredOutcome[remainingIVs[k]] ) { // the desired IV is not being inherited by parents
                spreadNumerator   *= 1;
                spreadDenominator *= 32;
            }
        }

        chanceofDesiredOutcome += (100/spreadDenominator)*spreadNumerator

    }

    if ( document.getElementById("gender-chance").value !== "" )
        chanceofDesiredOutcome = ( chanceofDesiredOutcome / 8 ) * document.getElementById("gender-chance").value

    if ( document.getElementById("ability-chance").value !== "" )
        chanceofDesiredOutcome = ( chanceofDesiredOutcome / 5 ) * document.getElementById("ability-chance").value

    if ( document.getElementById("nature-chance").value !== "" )
        chanceofDesiredOutcome = ( chanceofDesiredOutcome / 25 ) * document.getElementById("nature-chance").value

    if ( document.getElementById("shiny-chance").value !== "" )
        chanceofDesiredOutcome = ( chanceofDesiredOutcome / 4096 ) * document.getElementById("shiny-chance").value

    console.log(parseFloat(chanceofDesiredOutcome.toFixed(20)) + "%");

    return ( parseFloat( chanceofDesiredOutcome ) )
}

function check(box) {
    if(mouseDown) {
        box.checked = 1-box.checked;
        // box.checked = 1;
        // ^ If you only want to turn them on, use this.
    }
}

var mouseDown = false;
document.body.addEventListener("mousedown", () => { mouseDown = true; } )
document.body.addEventListener("mouseup",() => { mouseDown = false; } )
</script>

</body>
</html>